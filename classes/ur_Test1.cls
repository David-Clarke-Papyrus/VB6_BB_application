VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior = 0   'vbNone
  MTSTransactionMode = 0 'NotAnMTSObject
END
Attribute VB_Name = "ur_Test1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
'This database class was generated by CLASSter(tm)
'from Urfin Jus (www.urfinjus.net). Copyright 2000-2002, All rights reserved.
'   CLASSter Version: Version 2.2 (2.2.163), Access Edition
'   Date: 08 Nov 2003, 06:36
'   Connection string used:
'     "Provider=sqloledb;Data Source=PAPYRUS-94TNP9S;Initial Catalog=PBKSFD;User Id=sa;Password=;"
'   Dependencies: MS ADO Library; MS ADO Recordset Library
'                 HuntERR31.Bas
'
'Public Class Members
'=============================================================================
'
' Methods for calling individual stored procedures
'
' Execute SQLs
'Public Function AddSQLParam(Optional ByVal PValue As Variant, _
'                     Optional ByVal PName As String, _
'                     Optional ByVal PDir As ADODB.ParameterDirectionEnum = adParamInput, _
'                     Optional ByVal PType As ADODB.DataTypeEnum = adInteger, _
'                     Optional ByVal PSize As Long = 0, _
'                     Optional ByVal ZeroAsNull As Boolean = False) As Boolean
'Public Function ExecSQL(ByVal SQL As String, Optional ByVal Values) As Boolean
'
' Options
'Public Property Get Options(ByVal mask As ENUM_CTR_OPTIONS) As Boolean
'Public Property Let Options(ByVal mask As ENUM_CTR_OPTIONS, ByVal Value As Boolean)
'
' ADO objects/properties
'Public Property Get ConnectionString() As String
'Public Property Let ConnectionString(ByVal AValue As String)
'Public Property Get Connected() As Boolean
'Public Sub Connect()
'Public Sub Disconnect()
'Public Property Get Connection() As ADODB.Connection
'Public Property Set Connection(ByVal AConnection As ADODB.Connection)
'Public Property Get Command() As ADODB.Command
'Public Property Get Recordset() As ADODB.Recordset
'Public Sub DisconnectRecordset()
'Public Sub ReleaseConnection()
'Public Sub ReleaseADO()
'Public Sub SetADOSettings(Optional ByVal ACursorLocation, _
'                          Optional ByVal ACursorType, _
'                          Optional ByVal ALockType, _
'                          Optional ByVal AConnectionTimeout, _
'                          Optional ByVal ACommandTimeout, _
'                          Optional ByVal AnADOExecOptions)
'Public Property Get Value(ByVal FieldName As String) As Variant
'Public Property Get ValueIsNull(ByVal FieldName As String) As Boolean
'Public Function TestConnection(ByVal AConnectstring As String, ByRef ErrDescr As String) As Boolean
'Public Property Get ADOVersion() As String
'
' Parameters
'Public Property Get ParamValue(ByVal ParamName As String) As Variant
'Public Function ParamIsNull(ByVal ParamName As String) As Boolean
'Public Property Get ReturnValue() As Long
'
' Error Properties
'Public Property Get ErrorNumber() As Long
'Public Property Get ErrorSource() As String
'Public Property Get ErrorDescription() As String
'Public Property Get ErrorOccurred() As Boolean
'Public Sub ErrorClear()
'
' Transactions
'Public Function BeginTransaction() As Boolean
'Public Function SetComplete() As Boolean
'Public Function SetAbort() As Boolean
'
' Recordset Navigation
'Public Function MoveFirst() As Boolean
'Public Function MoveLast() As Boolean
'Public Function MoveNext() As Boolean
'Public Function MovePrevious() As Boolean
'Public Property Get EOF() As Boolean
'Public Property Get BOF() As Boolean
'Public Property Get HasRecords() As Boolean
'Public Property Get RecordCount() As Long
'
'
Option Explicit
Option Base 0
'
'Errors raised by database class code
Public Enum ENUM_ERRDB
    ERRCTR_BATCH_NOT_ACTIVE = ERRMAP_RESERVED_FIRST + 2
    ERRCTR_BATCH_PRMDUPLICATE
    ERRCTR_NO_CONNECTION_STRING
    ERRCTR_REGISTRY_FAILED
    ERRCTR_INVALID_PARAM_COUNT
    ERRCTR_INVALID_PARAMDEF
    ERRCTR_TYPE_NOT_SUPPORTED
    ERRCTR_SP_RETURNED_NON_ZERO
    ERRCTR_STRING_TOO_LONG
    ERRCTR_INVALID_NODESPEC
End Enum
'
Public Enum ENUM_CTR_OPTIONS 'Option flags, used as Options Property parameter
    CTRO_ERR_RAISE = &H1            'Raise error in public methods
    CTRO_ERR_SETABORT = &H2         'Abort transaction on error
    CTRO_ERR_DISABLECOMMIT = &H4    'Call GetObjectContext.DisableCommit on error
    CTRO_STRLEN_RAISE = &H10        'Raise error if parameter string is too long
    CTRO_STRLEN_TRIM = &H20         'Trim parameter string if too long
    CTRO_NULL_EMPTYSTR = &H40       'Substitute empty strings with Nulls
    CTRO_NULL_ZERODATE = &H80       'Substitute 0 dates with Nulls
    CTRO_AUTO_CONNCLOSE = &H100     'Auto close connection
    CTRO_AUTO_CONNRELEASE = &H200   'Auto release connection
    CTRO_AUTO_DISCONNECT_RSET = &H400 'Auto disconnect recordset
    CTRO_AUTO_SKIPCLOSED = &H800    'Automatically skip closed recordsets
    CTRO_AUTO_CHKRETVAL = &H1000    'Raise error if sp returned non-zero value (MS SQL, Sybase)
End Enum
'
'Set of private flags, used internally by database class
Private Enum CTRO_PRIVATE
    CTRO_IN_BATCH = &H1000000     'Set if Batch mode is On
    CTRO_IN_ADOTRANS = &H2000000  'Set if ADO transaction is in progress
    CTRO_IN_PARAMSQL = &H4000000  'Set if building parameterized SQL
    CTRO_SELFCONNECT = &H8000000  'Set if connection was opened by class itself
    CTRO_INITIALIZED = &H80000000 'Set if Initialize method was called
End Enum
Const DEFAULT_OPTIONS = _
    CTRO_ERR_RAISE + CTRO_STRLEN_TRIM + CTRO_NULL_EMPTYSTR + CTRO_NULL_ZERODATE
Const DEFAULT_ADOEXEC_OPTIONS = 0
Const ZERO_AS_NULL = True
Private mOptions As Long
'
'ADO objects
Private mConnection As ADODB.Connection
Private mCommand As ADODB.Command
Private mRecordset As ADODB.Recordset
Private mConnectionString As String
'
'ADO Settings
Private mCursorType As Long, mLockType As Long, mCursorLocation As Long
Private mConnectionTimeout As Long, mCommandTimeout As Long, mADOExecOptions As Long
Public RecordsetMaxRecords As Long
Public ProcGroup As Long
'
Const RETURN_VALUE = "RETURN_VALUE" 'Standard return value parameter name
Const EA_PUBLIC = EA_NORERAISE 'Actions for HuntERR.ErrorIn in public methods
Const STR_DEFAULT_CONNECTION = _
    "Provider=sqloledb;Data Source=PAPYRUS-94TNP9S;Initial Catalog=PBKSFD;User Id=sa;Password=;"
Const STR_ERROR_FILE = "Errors.txt"
'
'Error properties
Private mErrorNumber As Long, mErrorSource As String, mErrorDescription As String
'
'
' Methods for calling individual stored procedures
' ============================================================================
'
' Execute SQLs
Public Function AddSQLParam(Optional ByVal PValue As Variant, _
                     Optional ByVal PName As String, _
                     Optional ByVal PDir As ADODB.ParameterDirectionEnum = adParamInput, _
                     Optional ByVal PType As ADODB.DataTypeEnum = adInteger, _
                     Optional ByVal PSize As Long = 0, _
                     Optional ByVal ZeroAsNull As Boolean = False) As Boolean
    On Error GoTo errHandler
    If Not Options(CTRO_IN_PARAMSQL) Then InitCommand
    Options(CTRO_IN_PARAMSQL) = True
    AddParam PName, PType, PDir, PSize, PValue, ZeroAsNull
    Exit Function
errHandler:
    ErrorIn "ur_Test1.AddSQLParam(PValue,PName,PDir,PType,PSize,ZeroAsNull)", _
         Array(PValue, PName, PDir, PType, PSize, ZeroAsNull), EA_PUBLIC
    HandleError
End Function

Public Function ExecSQL(ByVal SQL As String, Optional ByVal Values) As Boolean
    On Error GoTo errHandler
    If Not IsMissing(Values) Then SQL = SQLInsertValues(SQL, Values)
    If Not Options(CTRO_IN_PARAMSQL) Then InitCommand
    Execute SQL, adCmdText
    Options(CTRO_IN_PARAMSQL) = False
    ExecSQL = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.ExecSQL(SQL,Values)", Array(SQL, Values), EA_PUBLIC
    HandleError
End Function

Private Function SQLInsertValues(ByVal IntoStr As String, ByVal Values) As String
    On Error GoTo errHandler
    Dim i As Long, ChrX As String
    ChrX = Chr$(vbKeyBack) 'Special char to act instead of % during manipulations
    IntoStr = Replace(IntoStr, "%", ChrX)
    If Not IsArray(Values) Then Values = Array(Values)
    For i = LBound(Values) To UBound(Values)
        IntoStr = Replace(IntoStr, ChrX & (i + 1), Replace(Values(i), "'", "''"))
    Next i
    SQLInsertValues = Replace(IntoStr, ChrX, "%") 'replace back
    Exit Function
errHandler:
    ErrorIn "ur_Test1.SQLInsertValues(IntoStr,Values)", Array(IntoStr, Values)
End Function

'
' Options
Public Property Get Options(ByVal mask As ENUM_CTR_OPTIONS) As Boolean
    If mOptions = 0 Then Initialize
    Options = ((mOptions And mask) <> 0)
End Property

Public Property Let Options(ByVal mask As ENUM_CTR_OPTIONS, ByVal Value As Boolean)
    If mOptions = 0 Then Initialize
    If Value Then mOptions = mOptions Or mask Else mOptions = mOptions And Not mask
End Property

'
' ADO objects/properties
Public Property Get ConnectionString() As String
    If mOptions = 0 Then Initialize
    If mConnectionString = "" Then
        ConnectionString = STR_DEFAULT_CONNECTION
        Else
        ConnectionString = mConnectionString
    End If
End Property

Public Property Let ConnectionString(ByVal AValue As String)
    If mOptions = 0 Then Initialize
    ReleaseConnection
    mConnectionString = AValue
End Property

Public Property Get Connected() As Boolean
    On Error Resume Next
    Connected = (mConnection.State = adStateOpen)
End Property

Public Sub Connect()
    On Error GoTo errHandler
    OpenConnection
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.Connect", , EA_PUBLIC
    HandleError
End Sub

Private Sub OpenConnection()
    On Error GoTo errHandler
    If mOptions = 0 Then Initialize
    If Connected Then Exit Sub
    If mConnection Is Nothing Then
        Set mConnection = New ADODB.Connection
        With mConnection
            .CursorLocation = mCursorLocation
            .ConnectionTimeout = mConnectionTimeout
        End With
    End If
    If mConnection.State = adStateOpen Then
        Options(CTRO_SELFCONNECT) = False
        Else
        Check Len(ConnectionString) > 0, ERRCTR_NO_CONNECTION_STRING, "Connection information is not provided."
        mConnection.Open ConnectionString
        Options(CTRO_SELFCONNECT) = True
    End If
    If Not mCommand Is Nothing Then Set mCommand.ActiveConnection = mConnection
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.OpenConnection", , , mConnection
End Sub

Public Sub Disconnect()
    On Error Resume Next
    mConnection.Close
    Options(CTRO_SELFCONNECT) = False
End Sub

Public Property Get Connection() As ADODB.Connection
    Set Connection = mConnection
End Property

Public Property Set Connection(ByVal AConnection As ADODB.Connection)
    Set mConnection = AConnection
    Options(CTRO_SELFCONNECT) = False
End Property

Public Property Get Command() As ADODB.Command
    Set Command = mCommand
End Property

Public Property Get Recordset() As ADODB.Recordset
    Set Recordset = mRecordset
End Property

Public Sub DisconnectRecordset()
    On Error Resume Next
    If Not mRecordset Is Nothing Then
        If mRecordset.State = adStateOpen Then Set mRecordset.ActiveConnection = Nothing
    End If
End Sub

Public Sub ReleaseConnection()
    On Error Resume Next
    If Options(CTRO_SELFCONNECT) Then Disconnect
    Set mRecordset.ActiveConnection = Nothing
    Set mCommand.ActiveConnection = Nothing
    Set mConnection = Nothing
End Sub

Public Sub ReleaseADO()
    On Error Resume Next
    ReleaseConnection
    Set mCommand = Nothing
    Set mRecordset = Nothing
End Sub

Public Sub SetADOSettings(Optional ByVal ACursorLocation, _
                          Optional ByVal ACursorType, _
                          Optional ByVal ALockType, _
                          Optional ByVal AConnectionTimeout, _
                          Optional ByVal ACommandTimeout, _
                          Optional ByVal AnADOExecOptions)
    On Error GoTo errHandler
    If Not IsMissing(ACursorLocation) Then mCursorLocation = ACursorLocation
    If Not IsMissing(ACursorType) Then mCursorType = ACursorType
    If Not IsMissing(ALockType) Then mLockType = ALockType
    If Not IsMissing(AConnectionTimeout) Then mConnectionTimeout = AConnectionTimeout
    If Not IsMissing(ACommandTimeout) Then mCommandTimeout = ACommandTimeout
    If Not IsMissing(AnADOExecOptions) Then mADOExecOptions = AnADOExecOptions
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.SetADOSettings(ACursorLocation,ACursorType,ALockType,AConnectionTimeout," & _
        "ACommandTimeout,AnADOExecOptions)", Array(ACursorLocation, ACursorType, ALockType, AConnectionTimeout, _
         ACommandTimeout, AnADOExecOptions), EA_PUBLIC
    HandleError
End Sub

Public Property Get Value(ByVal FieldName As String) As Variant
    Dim F As ADODB.Field
    On Error GoTo errHandler
    Set F = Recordset.Fields(FieldName)
    If Not IsNull(F.Value) Then Value = F.Value     'If field value is Null Value returns Empty
    Exit Property
errHandler:
    ErrorIn "ur_Test1.Value(AFieldName)", FieldName, EA_PUBLIC
    HandleError
End Property

Public Property Get ValueIsNull(ByVal FieldName As String) As Boolean
    On Error GoTo errHandler
    Dim F As ADODB.Field
    Set F = Recordset.Fields(FieldName)
    ValueIsNull = IsNull(F.Value)
    Exit Property
errHandler:
    ErrorIn "ur_Test1.ValueIsNull(FieldName)", FieldName, EA_PUBLIC
    HandleError
End Property

Public Function TestConnection(ByVal AConnectstring As String, ByRef ErrDescr As String) As Boolean
    Dim Conn As ADODB.Connection
    On Error GoTo ErrorHandler
    Set Conn = New ADODB.Connection
    Conn.Open AConnectstring
    TestConnection = True
    Exit Function
ErrorHandler:
    ErrDescr = Err.Description
End Function

Public Property Get ADOVersion() As String
    On Error Resume Next
    Dim Conn As Object
    Set Conn = CreateObject("ADODB.Connection")
    ADOVersion = Conn.version
End Property

'Private methods
Private Sub InitCommand()
    On Error GoTo errHandler
    If mOptions = 0 Then Initialize
    Set mCommand = New ADODB.Command
    mCommand.CommandTimeout = mCommandTimeout
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.InitCommand"
End Sub

Private Sub Execute(ByVal CommandText As String, _
                    Optional ByVal CommandType As Long = ADODB.adCmdStoredProc)
    On Error GoTo errHandler
    Dim RetVal As Long
    If Not Connected Then OpenConnection
    With mCommand
        If CommandType = adCmdStoredProc And ProcGroup > 0 Then CommandText = CommandText & ";" & ProcGroup
        .CommandText = CommandText
        .CommandType = CommandType
        Set .ActiveConnection = mConnection
    End With
    Set mRecordset = New ADODB.Recordset
    With mRecordset
        .CursorLocation = mCursorLocation
        If RecordsetMaxRecords > 0 Then .MaxRecords = RecordsetMaxRecords
        .Open mCommand, , mCursorType, mLockType, mADOExecOptions
    End With
    If CommandType = adCmdStoredProc And Options(CTRO_AUTO_CHKRETVAL) Then
        RetVal = PrmValue(RETURN_VALUE)
        Check RetVal = 0, ERRCTR_SP_RETURNED_NON_ZERO, _
            "Stored procedure returned non-zero value: " & RetVal
    End If
    If Options(CTRO_AUTO_DISCONNECT_RSET) Then DisconnectRecordset
    If Options(CTRO_AUTO_CONNCLOSE) Then Disconnect
    If Options(CTRO_AUTO_CONNRELEASE) Then ReleaseConnection
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.Execute(CommandText,CommandType)", Array(CommandText, CommandType), , mConnection
End Sub

'
' Parameters
Public Property Get ParamValue(ByVal ParamName As String) As Variant
    On Error GoTo errHandler
    ParamValue = PrmValue(ParamName)
    Exit Property
errHandler:
    ErrorIn "ur_Test1.ParamValue(ParamName)", ParamName, EA_PUBLIC
    HandleError
End Property

Public Function ParamIsNull(ByVal ParamName As String) As Boolean
    On Error GoTo errHandler
    ParamIsNull = IsNull(mCommand.Parameters(ParamName).Value)
    Exit Function
errHandler:
    ErrorIn "ur_Test1.ParamIsNull(ParamName)", ParamName, EA_PUBLIC
    HandleError
End Function

Public Property Get ReturnValue() As Long
    On Error GoTo errHandler
    ReturnValue = ParamValue(RETURN_VALUE)
    Exit Property
errHandler:
    ErrorIn "ur_Test1.ReturnValue", , EA_PUBLIC
    HandleError
End Property

Private Property Get PrmValue(ByVal ParamName As String) As Variant
    Dim P As ADODB.Parameter
    On Error GoTo errHandler
    Set P = mCommand.Parameters(ParamName)
    If Not IsNull(P.Value) Then PrmValue = P.Value
    Exit Property
errHandler:
    ErrorIn "ur_Test1.PrmValue(ParamName)", ParamName
End Property

Private Sub AddParam(ByVal PName As String, _
                     ByVal PType As ADODB.DataTypeEnum, _
                     ByVal PDir As ADODB.ParameterDirectionEnum, _
                     Optional ByVal PSize As Long, _
                     Optional ByVal PValue As Variant, _
                     Optional ByVal ZeroAsNull As Boolean = False)
    On Error GoTo errHandler
    If IsNull(PValue) Then
        'Nothing to do
    ElseIf IsEmpty(PValue) Or IsMissing(PValue) Then
        PValue = Null
    ElseIf ZeroAsNull Then
        If PValue = 0 Then PValue = Null
    Else
        Select Case PType
            Case adDate, adDBDate, adDBTime, adDBTimeStamp
                If PValue = 0 And Options(CTRO_NULL_ZERODATE) Then PValue = Null
            Case adChar, adWChar, adVarChar, adVarWChar, adLongVarChar, adLongVarWChar
                If PValue = "" And Options(CTRO_NULL_EMPTYSTR) Then
                    PValue = Null
                ElseIf Len(PValue) > PSize Then
                    If Options(CTRO_STRLEN_TRIM) Then
                        PValue = Left$(PValue, PSize)
                    ElseIf Options(CTRO_STRLEN_RAISE) Then
                        Check False, ERRCTR_STRING_TOO_LONG, _
                            "Size of Parameter " & PName & " exceedes max specified (" & PSize & ")"
                    End If 'Options(CTRO_STRLEN_TRIM) ...
                End If 'if PValue = "" ... elseif ...
        End Select 'Case PType
    End If
    With mCommand
        .Parameters.Append .CreateParameter(PName, PType, PDir, PSize, PValue)
    End With
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.AddParam(PName,PType,PDir,PSize,PValue,ZeroAsNull)", _
         Array(PName, PType, PDir, PSize, PValue, ZeroAsNull)
End Sub

'
' Error Properties
Public Property Get ErrorNumber() As Long
    ErrorNumber = mErrorNumber
End Property

Public Property Get ErrorSource() As String
    ErrorSource = mErrorSource
End Property

Public Property Get ErrorDescription() As String
    ErrorDescription = mErrorDescription
End Property

Public Property Get ErrorOccurred() As Boolean
    ErrorOccurred = (mErrorNumber <> 0)
End Property

Public Sub ErrorClear()
    mErrorNumber = 0
    mErrorSource = ""
    mErrorDescription = ""
End Sub

Private Sub Class_Initialize()
    If mOptions = 0 Then Initialize
End Sub

Private Sub Class_Terminate()
    ReleaseADO
End Sub

'
' Transactions
Public Function BeginTransaction() As Boolean
    On Error GoTo errHandler
    OpenConnection
    Options(CTRO_IN_ADOTRANS) = True
    mConnection.BeginTrans
    BeginTransaction = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.BeginTransaction", , EA_PUBLIC, mConnection
    HandleError
End Function

Public Function SetComplete() As Boolean
    On Error GoTo errHandler
    If Options(CTRO_IN_ADOTRANS) Then
        mConnection.CommitTrans
        Options(CTRO_IN_ADOTRANS) = False
    End If
    SetComplete = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.SetComplete", , EA_PUBLIC, mConnection
    HandleError
End Function

Public Function SetAbort() As Boolean
    On Error GoTo errHandler
    If Options(CTRO_IN_ADOTRANS) Then
        mConnection.RollbackTrans
        Options(CTRO_IN_ADOTRANS) = False
    End If
    SetAbort = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.SetAbort", , EA_PUBLIC, mConnection
    HandleError
End Function

'
' Recordset Navigation
Public Function MoveFirst() As Boolean
    On Error GoTo errHandler
    mRecordset.MoveFirst
    MoveFirst = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.MoveFirst", , EA_PUBLIC
    HandleError
End Function

Public Function MoveLast() As Boolean
    On Error GoTo errHandler
    mRecordset.MoveLast
    MoveLast = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.MoveLast", , EA_PUBLIC
    HandleError
End Function

Public Function MoveNext() As Boolean
    On Error GoTo errHandler
    mRecordset.MoveNext
    MoveNext = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.MoveNext", , EA_PUBLIC
    HandleError
End Function

Public Function MovePrevious() As Boolean
    On Error GoTo errHandler
    mRecordset.MovePrevious
    MovePrevious = True
    Exit Function
errHandler:
    ErrorIn "ur_Test1.MovePrevious", , EA_PUBLIC
    HandleError
End Function

Public Property Get EOF() As Boolean
    On Error GoTo errHandler
    EOF = mRecordset.EOF
    Exit Property
errHandler:
    ErrorIn "ur_Test1.EOF", , EA_PUBLIC
    HandleError
End Property

Public Property Get BOF() As Boolean
    On Error GoTo errHandler
    BOF = mRecordset.BOF
    Exit Property
errHandler:
    ErrorIn "ur_Test1.BOF", , EA_PUBLIC
    HandleError
End Property

Public Property Get HasRecords() As Boolean
    On Error Resume Next
    HasRecords = Not (mRecordset.EOF And mRecordset.BOF)
End Property

Public Property Get RecordCount() As Long
    On Error GoTo errHandler
    RecordCount = mRecordset.RecordCount
    Exit Property
errHandler:
    ErrorIn "ur_Test1.RecordCount", , EA_PUBLIC
    HandleError
End Property

Private Sub Initialize()
    On Error GoTo errHandler
    mOptions = DEFAULT_OPTIONS Or CTRO_INITIALIZED
    mCursorLocation = adUseClient
    mCursorType = adOpenForwardOnly
    mLockType = adLockReadOnly
    mConnectionTimeout = 15
    mCommandTimeout = 60
    mADOExecOptions = DEFAULT_ADOEXEC_OPTIONS
    Exit Sub
errHandler:
    ErrorIn "ur_Test1.Initialize"
End Sub

Private Sub HandleError()
    Dim sHelpFile As String 'HelpFile property is used by StopOnError, so we need to preserve it
    mErrorNumber = Err.Number
    mErrorSource = Err.Source
    mErrorDescription = Err.Description
    sHelpFile = Err.HelpFile
    On Error Resume Next
    'Disable/rollback transactions, log error here
    If Options(CTRO_ERR_SETABORT) Then SetAbort
    ErrSaveToFile STR_ERROR_FILE
    On Error GoTo 0
    If Options(CTRO_ERR_RAISE) Then Err.Raise mErrorNumber, mErrorSource, mErrorDescription, sHelpFile
End Sub